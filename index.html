<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¸ãƒ§ã‚¸ãƒ§TRPGã‚·ãƒ¼ãƒˆ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
  :root {
    --bg-main: #f0f9ff; --bg-panel: #e0f2fe; --text-main: #1e293b;
    --accent: #9333ea; --accent-gold: #d97706; --border: #cbd5e1;
    --danger: #ef4444; --spirit: #7e22ce; --stand-p: #10b981; --success: #10b981;
    --growth-bg: #dcfce7;
    --init-color: #3b82f6;
    --container-bg: #ffffff; --input-bg: #ffffff; --input-text: #0f172a;
  }
  * { box-sizing: border-box; }
  body {
    font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", sans-serif;
    background: var(--bg-main); color: var(--text-main); margin: 0; padding: 20px;
    background-image: linear-gradient(rgba(15,23,42,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(15,23,42,0.05) 1px, transparent 1px);
    background-size: 20px 20px;
  }
  .container {
    max-width: 1000px; margin: 0 auto; background: var(--container-bg); padding: 25px;
    border: 3px solid var(--accent); box-shadow: 10px 10px 0 rgba(147,51,234,0.2); border-radius: 12px; position: relative;
  }
  h1 { text-align: center; color: var(--accent); margin: 0 0 20px 0; border-bottom: 3px double var(--accent); padding-bottom: 10px; letter-spacing: 2px; }

  /* ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³ */
  .help-btn {
    position: absolute; top: 20px; right: 20px; width: 40px; height: 40px;
    background: var(--accent-gold); color: #fff; border-radius: 50%; border: none;
    font-weight: bold; font-size: 1.5rem; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  .help-btn:hover { transform: scale(1.1); }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
  .modal-content {
    background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 800px;
    border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); max-height: 80vh; overflow-y: auto;
  }
  .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
  .close:hover { color: black; }
  .modal h3 { border-left: 4px solid var(--accent); padding-left: 10px; color: var(--accent); margin-top: 20px; }
  .modal ul { list-style-type: square; padding-left: 20px; line-height: 1.8; }
  .modal li { margin-bottom: 5px; }
  .modal strong { color: var(--text-main); background: #f1f5f9; padding: 2px 6px; border-radius: 4px; }

  /* ç®¡ç†ãƒ‘ãƒãƒ« */
  .manager-panel { background: var(--bg-panel); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; border: 2px solid #bae6fd; }
  .char-list { padding: 8px; min-width: 200px; background: var(--input-bg); color: var(--input-text); border: 1px solid var(--border); border-radius: 4px; }
  .btn { padding: 8px 16px; border: 2px solid transparent; cursor: pointer; color: #fff; font-weight: bold; border-radius: 6px; transition: all 0.2s; font-size: 0.9rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.15); }
  .btn-save { background: var(--success); } .btn-load { background: #d97706; } .btn-del { background: var(--danger); }
  .btn-neutral { background: #64748b; } .btn-stand { background: var(--accent); color: #fff; }

  /* ã‚¿ãƒ– */
  .tab-menu { display: flex; border-bottom: 3px solid var(--accent); margin-bottom: 25px; }
  .tab-btn { padding: 12px 25px; background: #f1f5f9; cursor: pointer; color: #64748b; margin-right: 6px; border-radius: 8px 8px 0 0; font-weight: bold; border: 1px solid transparent; transition: all 0.2s; }
  .tab-btn.active { background: var(--accent); color: #fff; box-shadow: none; }
  .tab-content { display: none; animation: fadeIn 0.3s ease; } .tab-content.active { display: block; }
  @keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }

  /* ãƒ•ã‚©ãƒ¼ãƒ  */
  .row { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; } .col { flex: 1; min-width: 200px; }
  label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; color: var(--accent-gold); border-left: 4px solid var(--accent-gold); padding-left: 8px; background: #fffbeb; }
  input, textarea, select { width: 100%; padding: 10px; background: var(--input-bg); border: 2px solid #e2e8f0; color: var(--input-text); border-radius: 6px; font-family: inherit; font-size: 1rem; transition: border-color 0.2s; }
  input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); background: #faf5ff; }

  /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
  .status-container { display: flex; gap: 15px; margin: 20px 0; }
  .status-box { flex: 1; text-align: center; padding: 15px; border-radius: 12px; font-family: "Courier New", monospace; box-shadow: 4px 4px 0 rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: center; align-items: center; }
  .status-val { font-size: 2.2rem; font-weight: 900; line-height: 1; }
  .status-label { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; }
  .status-sub { font-size: 0.7rem; opacity: 0.8; }
  .hp-style { background: #fff1f2; color: var(--danger); border: 3px solid var(--danger); }
  .sp-style { background: #f3e8ff; color: var(--spirit); border: 3px solid var(--spirit); }
  .stp-style { background: #ecfdf5; color: var(--stand-p); border: 3px solid var(--stand-p); display: none; }
  .init-style { background: #eff6ff; color: var(--init-color); border: 3px solid var(--init-color); }

  /* æŠ€èƒ½ãƒã‚¤ãƒ³ãƒˆç®¡ç† */
  .skill-point-box {
    text-align:center; margin-bottom:15px; font-weight:bold; background:#e0f2fe; padding:15px; border-radius:8px; border:2px solid #bae6fd;
    display: flex; flex-direction: column; gap: 5px; align-items: center;
  }
  .sp-counter { font-size: 1.2rem; }
  .sp-counter span { font-size: 1.6rem; color: var(--accent-gold); }
  .sp-extra { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; background: #fff; padding: 5px 10px; border-radius: 6px; border: 1px solid #bae6fd; }
  .sp-extra input { width: 60px; text-align: center; padding: 5px; margin: 0; }
  .sp-cost-info { font-size: 0.8rem; color: #64748b; background: #fff; padding: 5px 10px; border-radius: 12px; border: 1px solid #e2e8f0; }

  /* èƒ½åŠ›å€¤ãƒ–ãƒ­ãƒƒã‚¯ */
  .attr-block { background: #f8fafc; border: 2px solid var(--border); padding: 15px; border-radius: 8px; margin-bottom: 10px; }
  .attr-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 15px; }
  .attr-header span { font-size: 1.1rem; font-weight: bold; color: var(--text-main); }
  .attr-header input { width: 70px; text-align: center; font-size: 1.2rem; font-weight: bold; background: #fff; border-color: var(--accent); color: var(--text-main); }
  
  .skill-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 0.9rem; }
  .skill-row label { flex-grow: 1; border: none; background: none; padding: 0; margin: 0; color: var(--text-main); font-weight: normal; cursor: pointer; }
  .skill-inputs { display: flex; align-items: center; gap: 4px; }
  .skill-base { width: 40px; text-align: center; padding: 4px; border: 1px solid #cbd5e1; border-radius: 4px; }
  .skill-growth { width: 40px; text-align: center; padding: 4px; border: 1px solid #10b981; background-color: var(--growth-bg); border-radius: 4px; color: #047857; font-weight: bold; }
  
  .skill-sub-name { width: 90px !important; text-align: left !important; font-size: 0.8rem; border-bottom: 1px solid #999; border-top:none; border-left:none; border-right:none; background:transparent; padding:0 5px; }
  .skill-header-row { display: flex; justify-content: flex-end; font-size: 0.7rem; color: #64748b; margin-bottom: 5px; padding-right: 5px; }
  .skill-header-item { width: 40px; text-align: center; }

  /* ç‹¬è‡ªæŠ€èƒ½ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
  .custom-skill-row { flex-wrap: wrap; }
  .custom-inputs-wrapper { flex-grow: 1; display: flex; gap: 5px; align-items: center; }
  .custom-name { width: 110px; font-size: 0.9rem; padding: 5px; border: 1px solid #cbd5e1; border-radius: 4px; }
  .custom-attr { width: 50px; padding: 5px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 0.8rem; background: #fff; }

  /* ã‚¹ã‚¿ãƒ³ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…¥åŠ›æ¬„ */
  .stand-param-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
  .stand-param-row label { flex-grow: 1; font-weight: bold; color: #333; border: none; background: none; padding: 0; }
  .stand-inputs { display: flex; align-items: center; gap: 5px; }
  .stand-base { width: 110px; padding: 5px; font-size: 0.9rem; }
  .stand-growth { width: 50px; text-align: center; padding: 5px; border: 2px solid #10b981; background-color: var(--growth-bg); border-radius: 4px; color: #047857; font-weight: bold; }

  /* ã‚¹ã‚¿ãƒ³ãƒ‰ */
  .awake-btn { width: 100%; padding: 20px; background: linear-gradient(135deg, #7c3aed, #9333ea); color: #fff; font-size: 1.3rem; font-weight: bold; border: none; cursor: pointer; margin: 30px 0; border-radius: 12px; box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4); transition: transform 0.2s; }
  .awake-btn:hover { transform: scale(1.02); }
  #stand-section { display: none; border: 3px solid var(--accent); padding: 20px; border-radius: 12px; background: #f3e8ff; margin-top: 20px; }

  /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
  #export-preview-area { background: #e2e8f0; padding: 20px; text-align: center; margin-top: 20px; border-radius: 8px; overflow-x: auto; border: 2px dashed #94a3b8; }
  #sheet-canvas { width: 800px; background: #fff; color: #1e293b; margin: 0 auto; text-align: left; padding: 30px; border: 8px solid #0f172a; position: relative; box-sizing: border-box; display: flex; flex-direction: column; gap: 15px; font-family: "Hiragino Mincho ProN", serif; }
  .sheet-header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 4px double #0f172a; padding-bottom: 10px; margin-bottom: 10px; }
  .sheet-title { font-size: 2rem; font-weight: 900; }
  .sheet-flex { display: flex; gap: 20px; align-items: stretch; }
  .sheet-box { flex: 1; border: 2px solid #0f172a; padding: 15px; border-radius: 4px; background: #f8fafc; position: relative; }
  .sheet-label { position: absolute; top: -12px; left: 10px; background: #0f172a; color: #fff; padding: 2px 10px; font-size: 0.8rem; font-weight: bold; border-radius: 4px; }
  .sheet-pc-name { font-size: 1.8rem; font-weight: bold; border-bottom: 2px solid #cbd5e1; margin-bottom: 5px; margin-top: 5px;}
  .sheet-stand-name { font-size: 1.6rem; font-weight: bold; color: #7c3aed; border-bottom: 2px solid #e9d5ff; margin-bottom: 5px; margin-top: 5px;}
  .sheet-param-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-weight: bold; background: #fff; padding: 10px; border: 1px solid #e2e8f0; margin-top: 10px; }
  .type-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; color: #fff; font-size: 0.75rem; margin-right: 5px; font-weight: bold; }
  .tag-form { background: #475569; } .tag-perf { background: #7c3aed; }

  /* ãƒˆãƒ¼ã‚¹ãƒˆ */
  #toast { visibility: hidden; min-width: 250px; background-color: var(--success); color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 99; left: 50%; bottom: 30px; transform: translateX(-50%); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
  #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
  @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
  @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
</style>
</head>
<body>

<div class="container">
  <button class="help-btn" onclick="document.getElementById('helpModal').style.display='block'">?</button>
  <h1>JOJO TRPG </h1>

  <div class="manager-panel">
    <label style="margin:0; color:var(--text-main); background:none; border:none;">DATA:</label>
    <select id="char-list" class="char-list"><option value="">(æ–°è¦ä½œæˆ)</option></select>
    <button class="btn btn-save" onclick="saveToBrowser()">ä¿å­˜</button>
    <button class="btn btn-load" onclick="loadFromBrowser()">èª­è¾¼</button>
    <button class="btn btn-del" onclick="deleteFromBrowser()">å‰Šé™¤</button>
    <div style="flex-grow:1;"></div>
    <button class="btn btn-neutral" onclick="downloadJSON()">â†“ JSONå‡ºåŠ›</button>
    <button class="btn btn-neutral" onclick="document.getElementById('file-input').click()">â†‘ èª­è¾¼</button>
    <input type="file" id="file-input" style="display:none;" onchange="uploadJSON(this)">
  </div>

  <div class="tab-menu">
    <div class="tab-btn active" onclick="switchTab('tab-stats', this)">â‘  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
    <div class="tab-btn" onclick="switchTab('tab-settings', this)">â‘¡ è©³ç´°è¨­å®š</div>
    <div class="tab-btn" onclick="switchTab('tab-share', this)">â‘¢ å‡ºåŠ›ãƒ»å…±æœ‰</div>
  </div>

  <div id="tab-stats" class="tab-content active">
    <!-- æŠ€èƒ½ãƒã‚¤ãƒ³ãƒˆç®¡ç† -->
    <div class="skill-point-box">
      <div class="sp-counter">
        æ®‹ã‚ŠæŠ€èƒ½P: <span id="skill-rem">20</span> / <span id="skill-max">20</span>
      </div>
      <div class="sp-cost-info">
        Lvä¸Šé™:3 (ã‚³ã‚¹ãƒˆ: Lv1=1pt / Lv2=5pt / Lv3=10pt)
      </div>
      <div class="sp-extra">
        <label style="border:none;background:none;padding:0;margin:0;">ãƒœãƒ¼ãƒŠã‚¹P:</label>
        <input type="number" id="bonus-points" value="0" min="0" onchange="calcAll()" placeholder="0" style="width:50px;text-align:center;">
      </div>
    </div>

    <div class="row">
      <div class="col" style="flex:2;"><label>åå‰</label><input type="text" id="pc-name" placeholder="ä¾‹ï¼šã‚¸ãƒ§ãƒ‹ã‚£ãƒ»ã‚¸ãƒ§ãƒ¼ã‚¹ã‚¿ãƒ¼"></div>
      <div class="col"><label>å¹´é½¢</label><input type="number" id="pc-age" value="19" min="0" onchange="calcAll()"></div>
      <div class="col"><label>è·æ¥­</label><input type="text" id="pc-job" placeholder="ä¾‹ï¼šé¨æ‰‹"></div>
    </div>
    <div id="aging-info" style="font-size:0.9rem; color:var(--accent-gold); text-align:right; margin-top:-10px; margin-bottom:10px; font-weight:bold;"></div>
    
    <div class="status-container">
      <div class="status-box hp-style">
        <span class="status-label">HP (è€ä¹…åŠ›)</span>
        <span class="status-val" id="hp-val">0</span>
        <span class="status-sub">(ä½“+ç²¾)Ã—2</span>
      </div>
      <div class="status-box sp-style">
        <span class="status-label">SP (é­‚å€¤)</span>
        <span class="status-val" id="sp-val">0</span>
        <span class="status-sub">(çŸ¥+ç²¾)Ã—5</span>
      </div>
      <div class="status-box stp-style" id="stp-container">
        <span class="status-label">STP (Energy)</span>
        <span class="status-val" id="stp-val">0</span>
        <span class="status-sub">(ç²¾+æŒç¶š)Ã—5</span>
      </div>
      <div class="status-box init-style">
        <span class="status-label">INIT (è¡Œå‹•é †)</span>
        <span class="status-val" id="init-val">0</span>
        <span class="status-sub" id="init-label">ä½“+é‹å‹•</span>
      </div>
    </div>

    <!-- æœ¬ä½“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆ6ç¨®ï¼‰ -->
    <div class="row">
      <div class="col attr-block">
        <div class="attr-header"><span>ãƒœãƒ‡ã‚£(ä½“)</span><input type="number" id="body" value="1" min="1" max="10" onchange="calcAll()"></div>
        <div class="skill-header-row"><div class="skill-header-item">æŠ€èƒ½P</div><div class="skill-header-item">ãã®ä»–</div></div>
        <div class="skill-row"><label>é‹å‹•</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="body" data-name="é‹å‹•" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>æ ¼é—˜</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="body" data-name="æ ¼é—˜" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>è€ä¹…</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="body" data-name="è€ä¹…" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>ä¹—é¦¬</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="body" data-name="ä¹—é¦¬" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
      </div>
      <div class="col attr-block">
        <div class="attr-header"><span>ã‚»ãƒ³ã‚¹(æ„Ÿ)</span><input type="number" id="sense" value="1" min="1" max="10" onchange="calcAll()"></div>
        <div class="skill-header-row"><div class="skill-header-item">æŠ€èƒ½P</div><div class="skill-header-item">ãã®ä»–</div></div>
        <div class="skill-row"><label>è¦³å¯Ÿçœ¼</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="sense" data-name="è¦³å¯Ÿçœ¼" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>éš å¯†</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="sense" data-name="éš å¯†" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>æ‰‹æ¥­</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="sense" data-name="æ‰‹æ¥­" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>å°„æ’ƒ</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="sense" data-name="å°„æ’ƒ" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>æ“ç¸¦:<input type="text" id="drive-text" class="skill-sub-name" placeholder="è»Š/æ©Ÿ"></label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="sense" data-name="æ“ç¸¦" data-sub="drive-text" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
      </div>
    </div>
    
    <div class="row">
      <div class="col attr-block">
        <div class="attr-header"><span>ã‚¤ãƒ³ãƒ†ãƒª(çŸ¥)</span><input type="number" id="intelli" value="1" min="1" max="10" onchange="calcAll()"></div>
        <div class="skill-header-row"><div class="skill-header-item">æŠ€èƒ½P</div><div class="skill-header-item">ãã®ä»–</div></div>
        <div class="skill-row"><label>åŒ»å­¦</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="intelli" data-name="åŒ»å­¦" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>åˆ†æ</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="intelli" data-name="åˆ†æ" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>èª¿æŸ»</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="intelli" data-name="èª¿æŸ»" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>çŸ¥è­˜:<input type="text" id="know1-text" class="skill-sub-name" placeholder="ç”Ÿç‰©å­¦ç­‰"></label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="intelli" data-name="çŸ¥è­˜" data-sub="know1-text" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>çŸ¥è­˜:<input type="text" id="know2-text" class="skill-sub-name" placeholder="ç‰©ç†å­¦ç­‰"></label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="intelli" data-name="çŸ¥è­˜" data-sub="know2-text" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
      </div>
      <div class="col attr-block">
        <div class="attr-header"><span>ãƒ¡ãƒ³ã‚¿ãƒ«(ç²¾)</span><input type="number" id="mental" value="1" min="1" max="10" onchange="calcAll()"></div>
        <div class="skill-header-row"><div class="skill-header-item">æŠ€èƒ½P</div><div class="skill-header-item">ãã®ä»–</div></div>
        <div class="skill-row"><label>æ´å¯Ÿ</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="mental" data-name="æ´å¯Ÿ" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>ã‚ªã‚«ãƒ«ãƒˆ</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="mental" data-name="ã‚ªã‚«ãƒ«ãƒˆ" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>æ„å¿—</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="mental" data-name="æ„å¿—" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
      </div>
    </div>

    <!-- è¿½åŠ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div class="row">
      <div class="col attr-block">
        <div class="attr-header"><span>ãƒãƒ£ãƒ¼ãƒ (é­…)</span><input type="number" id="charm" value="1" min="1" max="10" onchange="calcAll()"></div>
        <div class="skill-header-row"><div class="skill-header-item">æŠ€èƒ½P</div><div class="skill-header-item">ãã®ä»–</div></div>
        <div class="skill-row"><label>äº¤æ¸‰</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="charm" data-name="äº¤æ¸‰" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>å¨åœ§</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="charm" data-name="å¨åœ§" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>ç¾å£°</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="charm" data-name="ç¾å£°" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>è©æ¬º</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="charm" data-name="è©æ¬º" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>èŠ¸è¡“:<input type="text" id="art-text" class="skill-sub-name" placeholder="æ¼«ç”»ç­‰"></label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="charm" data-name="èŠ¸è¡“" data-sub="art-text" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
      </div>
      <div class="col attr-block">
        <div class="attr-header"><span>ãƒ©ãƒƒã‚¯(é‹)</span><input type="number" id="luck" value="1" min="1" max="10" onchange="calcAll()"></div>
        <div class="skill-header-row"><div class="skill-header-item">æŠ€èƒ½P</div><div class="skill-header-item">ãã®ä»–</div></div>
        <div class="skill-row"><label>ç›´æ„Ÿ</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="luck" data-name="ç›´æ„Ÿ" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>è³­åš</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="luck" data-name="è³­åš" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
        <div class="skill-row"><label>å¼·é‹</label><div class="skill-inputs"><input type="number" class="skill-base" data-attr="luck" data-name="å¼·é‹" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv"><input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–"></div></div>
      </div>
    </div>
    
    <!-- ç‹¬è‡ªæŠ€èƒ½ -->
    <div class="row">
      <div class="col attr-block" style="flex-basis: 100%;">
        <div class="attr-header"><span>ç‹¬è‡ªæŠ€èƒ½ (Custom)</span></div>
        <div class="skill-header-row" style="padding-right: 8px;">
            <span style="margin-right: auto; padding-left: 5px; font-size: 0.7rem;">æŠ€èƒ½å / é–¢é€£èƒ½åŠ›</span>
            <div class="skill-header-item">æŠ€èƒ½P</div>
            <div class="skill-header-item">ãã®ä»–</div>
        </div>
        
        <div class="skill-row custom-skill-row">
            <div class="custom-inputs-wrapper">
                <input type="text" class="custom-name" placeholder="ä¾‹: æ³¢ç´‹æ³•">
                <select class="custom-attr" onchange="calcAll()">
                    <option value="body">ä½“</option>
                    <option value="sense">æ„Ÿ</option>
                    <option value="intelli">çŸ¥</option>
                    <option value="mental">ç²¾</option>
                    <option value="charm">é­…</option>
                    <option value="luck">é‹</option>
                </select>
            </div>
            <div class="skill-inputs">
                <input type="number" class="skill-base custom-base" data-is-custom="true" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv">
                <input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–">
            </div>
        </div>
        <div class="skill-row custom-skill-row">
            <div class="custom-inputs-wrapper">
                <input type="text" class="custom-name" placeholder="ä¾‹: é‰„çƒ">
                <select class="custom-attr" onchange="calcAll()">
                    <option value="body">ä½“</option>
                    <option value="sense">æ„Ÿ</option>
                    <option value="intelli">çŸ¥</option>
                    <option value="mental">ç²¾</option>
                    <option value="charm">é­…</option>
                    <option value="luck">é‹</option>
                </select>
            </div>
            <div class="skill-inputs">
                <input type="number" class="skill-base custom-base" data-is-custom="true" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv">
                <input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–">
            </div>
        </div>
        <div class="skill-row custom-skill-row">
            <div class="custom-inputs-wrapper">
                <input type="text" class="custom-name" placeholder="è‡ªç”±è¨˜å…¥">
                <select class="custom-attr" onchange="calcAll()">
                    <option value="body">ä½“</option>
                    <option value="sense">æ„Ÿ</option>
                    <option value="intelli">çŸ¥</option>
                    <option value="mental">ç²¾</option>
                    <option value="charm">é­…</option>
                    <option value="luck">é‹</option>
                </select>
            </div>
            <div class="skill-inputs">
                <input type="number" class="skill-base custom-base" data-is-custom="true" value="0" min="0" max="3" onchange="calcAll()" placeholder="Lv">
                <input type="number" class="skill-growth" value="0" min="0" onchange="calcAll()" placeholder="ä»–">
            </div>
        </div>
      </div>
    </div>
    
    <button class="awake-btn" onclick="awakeStand()">çŸ¢ã«è²«ã‹ã‚Œã‚‹ğŸ¹ï¼ˆã‚¹ã‚¿ãƒ³ãƒ‰ç™ºç¾ï¼‰</button>
    
    <div id="stand-section">
      <h2 style="color:var(--accent); border-bottom:2px solid var(--accent); margin-top:0;">â–¼ STAND PARAMETERS</h2>
      <div id="stand-age-warn" style="color:var(--danger); font-size:0.9rem; font-weight:bold; margin-bottom:10px;">KPã‹ã‚‰æŒ‡ç¤ºãŒã‚ã‚‹ã¾ã§å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ã€‚</div>
      <div style="text-align:right; font-size:0.8rem; color:#666; margin-top:-15px; margin-bottom:10px;">[ãƒ©ãƒ³ã‚¯] + [æˆé•·å€¤]</div>
      
      <div class="row">
        <div class="col"><label>å¤–è¦‹ãƒ»åˆ†é¡</label>
          <select id="stand-form">
            <option value="äººå‹ãƒ»ç”Ÿç‰©">äººå‹ (ç”Ÿç‰©ãƒ»è‡ªç„¶å‹)</option>
            <option value="äººå‹ãƒ»æ©Ÿæ¢°">äººå‹ (äººå·¥ãƒ»æ©Ÿæ¢°å‹)</option>
            <option value="éäººå‹ãƒ»ç”Ÿç‰©">éäººå‹ (ç”Ÿç‰©ãƒ»è‡ªç„¶å‹)</option>
            <option value="éäººå‹ãƒ»æ©Ÿæ¢°">éäººå‹ (äººå·¥ãƒ»æ©Ÿæ¢°å‹)</option>
            <option value="è£…å‚™ãƒ»é“å…·å‹">è£…å‚™ãƒ»é“å…·å‹</option>
            <option value="ç¾¤ä½“å‹">ç¾¤ä½“å‹</option>
            <option value="ä¸å®šå½¢">ä¸å®šå½¢</option>
            <option value="ãƒ´ã‚£ã‚¸ãƒ§ãƒ³ç„¡ã—">ãƒ´ã‚£ã‚¸ãƒ§ãƒ³ç„¡ã—</option>
          </select>
        </div>
        <div class="col"><label>æ€§èƒ½ã‚¿ã‚¤ãƒ—</label>
          <select id="stand-type">
            <option value="è¿‘æ¥ã‚¿ã‚¤ãƒ—">è¿‘æ¥ã‚¿ã‚¤ãƒ—</option>
            <option value="é éš”ã‚¿ã‚¤ãƒ—">é éš”ã‚¿ã‚¤ãƒ—</option>
            <option value="è‡ªå‹•æ“ç¸¦ã‚¿ã‚¤ãƒ—">è‡ªå‹•æ“ç¸¦ã‚¿ã‚¤ãƒ—</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="col"><label>ã‚¹ã‚¿ãƒ³ãƒ‰å</label><input type="text" id="stand-name" placeholder="ä¾‹ï¼šãƒã‚¸ã‚·ãƒ£ãƒ³ã‚ºãƒ¬ãƒƒãƒ‰"></div>
        <div class="col"><label>èƒ½åŠ›æ¦‚è¦</label><input type="text" id="stand-ability" placeholder="ä¾‹ï¼šç‚ã‚’æ“ã‚‹"></div>
      </div>
      <label>ãƒ«ãƒ¼ãƒ«ãƒ»åˆ¶ç´„</label><textarea id="stand-rule" rows="2"></textarea>
      
      <div class="row" style="margin-top:20px; align-items:center;">
        <div class="col">
          <div class="stand-param-row">
            <label>ç ´å£ŠåŠ›</label>
            <div class="stand-inputs">
              <select id="p-power" class="stand-base" onchange="updateChart()"><option value="0">?</option><option value="5">A (è¶…ã‚¹ã‚´ã‚¤)</option><option value="4">B (ã‚¹ã‚´ã‚¤)</option><option value="3">C (ä¸¦)</option><option value="2">D (ãƒ‹ã‚¬ãƒ†)</option><option value="1">E (è¶…ãƒ‹ã‚¬ãƒ†)</option></select>
              <input type="number" id="g-power" class="stand-growth" value="0" min="0" onchange="updateChart()" placeholder="+">
            </div>
          </div>
          <div class="stand-param-row">
            <label>ã‚¹ãƒ”ãƒ¼ãƒ‰</label>
            <div class="stand-inputs">
              <select id="p-speed" class="stand-base" onchange="updateChart()"><option value="0">?</option><option value="5">A (ç¥é€Ÿ)</option><option value="4">B (é«˜é€Ÿ)</option><option value="3">C (ä¸¦)</option><option value="2">D (éˆã„)</option><option value="1">E (é…ã„)</option></select>
              <input type="number" id="g-speed" class="stand-growth" value="0" min="0" onchange="updateChart()" placeholder="+">
            </div>
          </div>
          <div class="stand-param-row">
            <label>å°„ç¨‹è·é›¢</label>
            <div class="stand-inputs">
              <select id="p-range" class="stand-base" onchange="updateChart()"><option value="0">?</option><option value="5">A (è¶…é è·é›¢)</option><option value="4">B (50mç¨‹)</option><option value="3">C (10må‰å¾Œ)</option><option value="2">D (5mä»¥å†…)</option><option value="1">E (2mä»¥å†…)</option></select>
              <input type="number" id="g-range" class="stand-growth" value="0" min="0" onchange="updateChart()" placeholder="+">
            </div>
          </div>
          <div style="margin-bottom:12px;"><input type="text" id="stand-range-text" placeholder="æœ‰åŠ¹å°„ç¨‹ (ä¾‹: 2m)" style="width:100%; text-align:left; font-size:0.9rem; padding:5px; border:1px solid #ccc; border-radius:4px;"></div>
          
          <div class="stand-param-row">
            <label>æŒç¶šåŠ›</label>
            <div class="stand-inputs">
              <select id="p-durability" class="stand-base" onchange="updateChart()"><option value="0">?</option><option value="5">A (è¶…æŒç¶š)</option><option value="4">B (é•·ã„)</option><option value="3">C (ä¸¦)</option><option value="2">D (çŸ­ã„)</option><option value="1">E (ä¸€ç¬)</option></select>
              <input type="number" id="g-durability" class="stand-growth" value="0" min="0" onchange="updateChart()" placeholder="+">
            </div>
          </div>
          <div class="stand-param-row">
            <label>ç²¾å¯†å‹•ä½œ</label>
            <div class="stand-inputs">
              <select id="p-precision" class="stand-base" onchange="updateChart()"><option value="0">?</option><option value="5">A (æ©Ÿæ¢°ä»¥ä¸Š)</option><option value="4">B (æ­£ç¢º)</option><option value="3">C (äººé–“ä¸¦)</option><option value="2">D (å¤§é›‘æŠŠ)</option><option value="1">E (çš†ç„¡)</option></select>
              <input type="number" id="g-precision" class="stand-growth" value="0" min="0" onchange="updateChart()" placeholder="+">
            </div>
          </div>
          <div class="stand-param-row">
            <label>æˆé•·æ€§</label>
            <div class="stand-inputs">
              <select id="p-potential" class="stand-base" onchange="updateChart()"><option value="0">?</option><option value="5">A (æ¿€å¤‰)</option><option value="4">B (æˆé•·ä¸­)</option><option value="3">C (å®‰å®š)</option><option value="2">D (ç¿’ç†Ÿ)</option><option value="1">E (å®Œæˆ)</option></select>
              <input type="number" id="g-potential" class="stand-growth" value="0" min="0" onchange="updateChart()" placeholder="+">
            </div>
          </div>
        </div>
        <div class="col" style="max-width:350px; background:#fff; padding:10px; border-radius:8px; border:1px solid #e2e8f0;">
          <canvas id="standChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div id="tab-settings" class="tab-content">
    <div class="row">
      <div class="col"><label>æ‰€æŒå“ãƒ»ã‚¢ã‚¤ãƒ†ãƒ </label><textarea id="pc-items" placeholder="ä¾‹ï¼šã‚¹ãƒãƒ›ã€è²¡å¸ƒã€ãƒ­ãƒ¼ãƒ—..." style="height:60px;"></textarea></div>
    </div>
    <div class="row">
      <div class="col"><label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å</label><input type="text" id="pl-name"></div>
      <div class="col"><label>ä¸€äººç§° / å£èª¿</label><input type="text" id="pc-tone"></div>
    </div>
    <div class="row">
      <div class="col"><label>ã“ã ã‚ã‚Š (RPæŒ‡é‡)</label><textarea id="pc-quirk" rows="3"></textarea></div>
      <div class="col"><label>å¼•åŠ› (æƒ¹ã‹ã‚ŒãŸã‚‚ã®)</label><textarea id="pc-hook" rows="3"></textarea></div>
    </div>
    <label>èƒŒæ™¯ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ»è©³ç´°è¨­å®š</label>
    <textarea id="pc-background" style="height:200px;"></textarea>
  </div>

  <div id="tab-share" class="tab-content">
    <div class="export-actions">
      <button class="btn btn-stand" style="font-size:1.1rem; padding:15px 30px;" onclick="generateImage()">ğŸ“· ç”»åƒã¨ã—ã¦ä¿å­˜</button>
      <button class="btn btn-neutral" style="font-size:1.1rem; padding:15px 30px;" onclick="generateText()">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
    </div>
    
    <div style="text-align:center; margin-bottom:20px; padding:15px; background:#e0f2fe; border-radius:8px; border:1px solid #bae6fd;">
      <label style="color:var(--text-main); margin-bottom:10px; background:none; border:none; padding:0;">ã‚³ã‚³ãƒ•ã‚©ãƒªã‚¢ç”¨ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å‡ºåŠ›</label>
      <div style="display:flex; gap:10px; justify-content:center;">
        <button class="btn btn-save" onclick="copyPC()">â‘  æœ¬ä½“ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn btn-stand" onclick="copyStand()">â‘¡ ã‚¹ã‚¿ãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>
    </div>

    <p style="text-align:center; color:#64748b;">â–¼ ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â–¼</p>
    <div id="export-preview-area">
      <div id="sheet-canvas">
        <div class="sheet-header">
          <div class="sheet-title">JOJO TRPG PROFILE</div>
          <div class="sheet-logo">SPW FOUNDATION DATABASE</div>
        </div>
        <div class="sheet-flex">
          <div class="sheet-box">
            <span class="sheet-label">USER DATA</span>
            <div class="sheet-pc-name" id="out-pc-name">NO NAME</div>
            <div style="font-size:0.9rem; margin-bottom:10px;">Age: <span id="out-pc-age" style="font-weight:bold;">--</span> / Job: <span id="out-pc-job" style="font-weight:bold;">--</span></div>
            <div style="background:#eee; padding:10px; border-radius:4px; margin-bottom:10px;"><div id="out-pc-stats" style="line-height:1.8; font-family:'Courier New', monospace;"></div></div>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
              <div style="flex:1; border:2px solid var(--danger); background:#fff1f2; text-align:center; padding:5px; border-radius:4px; font-weight:bold; color:var(--danger);">HP: <span id="out-hp-val" style="font-size:1.2rem;">0</span></div>
              <div style="flex:1; border:2px solid var(--spirit); background:#f3e8ff; text-align:center; padding:5px; border-radius:4px; font-weight:bold; color:var(--spirit);">SP: <span id="out-sp-val" style="font-size:1.2rem;">0</span></div>
              <div id="out-stp-box" style="flex:1; border:2px solid var(--success); background:#ecfdf5; text-align:center; padding:5px; border-radius:4px; font-weight:bold; color:var(--success); display:none;">STP: <span id="out-stp-val" style="font-size:1.2rem;">0</span></div>
            </div>
            <div style="font-size:0.85rem; margin-bottom:8px;"><strong>[æ‰€æŒå“]</strong><br><span id="out-pc-items"></span></div>
            <div style="font-size:0.85rem; margin-bottom:8px;"><strong>[ã“ã ã‚ã‚Š]</strong><br><span id="out-pc-quirk"></span></div>
          </div>
          <div class="sheet-box">
            <span class="sheet-label">STAND DATA</span>
            <div class="sheet-stand-name" id="out-stand-name">---</div>
            <div style="margin-bottom:10px;"><span id="out-stand-form" class="type-tag tag-form"></span><span id="out-stand-type" class="type-tag tag-perf"></span></div>
            <div style="font-size:0.9rem; margin-bottom:10px;">èƒ½åŠ›: <span id="out-stand-ability" style="font-weight:bold;">---</span></div>
            <div class="sheet-stand-visual"><canvas id="outChart"></canvas></div>
            <div class="sheet-param-grid" id="out-stand-params"></div>
            <div style="margin-top:10px; font-size:0.8rem; background:#eee; padding:5px; border-left:3px solid #7c3aed;"><strong>[ãƒ«ãƒ¼ãƒ«]</strong> <span id="out-stand-rule"></span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="document.getElementById('helpModal').style.display='none'">&times;</span>
    <h2 style="text-align:center; color:var(--accent);">ç”¨èªé›†</h2>
    <ul>
      <li><strong>æŠ€èƒ½ã‚³ã‚¹ãƒˆ</strong>ï¼š Lv1=1 / Lv2=5 / Lv3=10 (ç´¯è¨ˆ)</li>
      <li><strong>ã‚¤ãƒ‹ã‚·ã‚¢ãƒ†ã‚£ãƒ–(è¡Œå‹•é †)</strong>ï¼š
        <ul>
          <li>ä¸€èˆ¬äººï¼šãƒœãƒ‡ã‚£ + é‹å‹•Lv(åˆè¨ˆ)</li>
          <li>ã‚¹ã‚¿ãƒ³ãƒ‰ä½¿ã„ï¼šã‚¹ãƒ”ãƒ¼ãƒ‰ + ãƒœãƒ‡ã‚£ + é‹å‹•Lv(åˆè¨ˆ)</li>
        </ul>
      </li>
      <li><strong>æœ¬ä½“èƒ½åŠ›ãƒ­ãƒ¼ãƒ«</strong>ï¼š 1B20 <= (èƒ½åŠ›å€¤Ã—2)</li>
      <li><strong>æœ¬ä½“æŠ€èƒ½ãƒ­ãƒ¼ãƒ«</strong>ï¼š æŠ€èƒ½Lvæ•°B20 <= (èƒ½åŠ›å€¤Ã—2 + æŠ€èƒ½Lvåˆè¨ˆ)</li>
      <li><strong>ã‚¹ã‚¿ãƒ³ãƒ‰åˆ¤å®š</strong>ï¼š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ•°B20 <= (ç›®æ¨™å€¤) ã€æ¶ˆè²»STP:2ã€‘</li>
      <li><strong>ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«</strong>ï¼š å‡ºç›®ã€1ã€‘</li>
      <li><strong>ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼</strong>ï¼š å‡ºç›®ã€20ã€‘</li>
      <li><strong>ãƒ•ã‚¡ã‚¤ãƒŠãƒ«ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒ¼</strong>ï¼š æˆåŠŸæ•°0 ã‹ã¤ å‡ºç›®ã€20ã€‘</li>
      <li><strong>STPæ¶ˆè²»</strong>ï¼š ã‚¹ã‚¿ãƒ³ãƒ‰ã§ã®è¡Œå‹•-2 / ã‚¿ãƒ¼ãƒ³çµŒé-1</li>
      <li><strong>STPå›å¾©</strong>ï¼š ã‚¹ã‚¿ãƒ³ãƒ‰ONå¾…æ©Ÿ +2 / ã‚¹ã‚¿ãƒ³ãƒ‰OFFå¾…æ©Ÿ +5 / ä¼‘æ†© å…¨å¿« / SPå¤‰æ›(1â†’2)</li>
     
    </ul>
  </div>
</div>

<div id="toast">å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ</div>

<script>
  let baseSkillPoints = 20; let maxSkillPoints = 20; let isAwake = false; let myChart = null; let outChartInst = null;
  const STORAGE_KEY = 'jojo_trpg_db_v300_skill_limit';

  // --- å…±é€šãƒ»è¨ˆç®—å‡¦ç† ---
  function switchTab(tabId, btn) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
    document.getElementById(tabId).classList.add('active'); btn.classList.add('active');
    if(tabId === 'tab-share') updateExportView();
  }
  function showToast(msg) { const t = document.getElementById("toast"); t.innerText = msg; t.className = "show"; setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000); }
  function safeCopy(text) { const textArea = document.createElement("textarea"); textArea.value = text; textArea.style.position = "fixed"; textArea.style.left = "-9999px"; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); showToast("ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); } catch (err) { showToast("ã‚³ãƒ”ãƒ¼å¤±æ•—"); } document.body.removeChild(textArea); }

  // æŠ€èƒ½ã‚³ã‚¹ãƒˆè¨ˆç®—
  function getSkillCost(level) {
    if (level <= 0) return 0;
    if (level === 1) return 1;
    if (level === 2) return 5;
    if (level >= 3) return 10;
    return 0;
  }

  function calcAll() {
    const age = parseInt(document.getElementById('pc-age').value) || 17;
    let ageBonus=0, text="", warn="";
    if (age>=80) { text="ã€è¶…è€å¹´ã€‘(+8P)"; ageBonus=8; warn="â€»è€å¹´: è‚‰ä½“ä¸Šé™2 / ã‚¹ã‚¿ãƒ³ãƒ‰ç ´å£Šãƒ»é€Ÿ-2"; }
    else if (age>=60) { text="ã€è€å¹´ã€‘(+5P)"; ageBonus=5; warn="â€»è€å¹´: è‚‰ä½“ä¸Šé™3 / ã‚¹ã‚¿ãƒ³ãƒ‰é€Ÿãƒ»æŒç¶š-1"; }
    else if (age>=30) { text="ã€å£®å¹´ã€‘(+2P)"; ageBonus=2; }
    document.getElementById('aging-info').innerText = text;
    document.getElementById('stand-age-warn').innerText = "KPã‹ã‚‰æŒ‡ç¤ºãŒã‚ã‚‹ã¾ã§å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ã€‚";
    
    const extraBonus = parseInt(document.getElementById('bonus-points').value) || 0;
    maxSkillPoints = baseSkillPoints + ageBonus + extraBonus;

    const body = parseInt(document.getElementById('body').value)||1;
    const sense = parseInt(document.getElementById('sense').value)||1;
    const intelli = parseInt(document.getElementById('intelli').value)||1;
    const mental = parseInt(document.getElementById('mental').value)||1;
    const charm = parseInt(document.getElementById('charm').value)||1;
    const luck = parseInt(document.getElementById('luck').value)||1;

    const hp = (body + mental) * 2;
    const sp = (intelli + mental) * 5;
    document.getElementById('hp-val').innerText = hp;
    document.getElementById('sp-val').innerText = sp;

    let durTotal = 0;
    if (isAwake) {
        const base = parseInt(document.getElementById('p-durability').value) || 0;
        const growth = parseInt(document.getElementById('g-durability').value) || 0;
        durTotal = base + growth;
    }
    const stp = (mental + durTotal) * 5;
    document.getElementById('stp-val').innerText = stp;

    let athleticsBase = 0;
    let athleticsGrowth = 0;
    const athBaseInput = document.querySelector('input.skill-base[data-name="é‹å‹•"]');
    if(athBaseInput) athleticsBase = parseInt(athBaseInput.value) || 0;
    const athGrowthInput = athBaseInput ? athBaseInput.nextElementSibling : null;
    if(athGrowthInput) athleticsGrowth = parseInt(athGrowthInput.value) || 0;
    const athleticsTotal = athleticsBase + athleticsGrowth;

    let initVal = body + athleticsTotal; 
    let labelText = "ä½“+é‹å‹•";

    if(isAwake) {
        const baseSpeed = parseInt(document.getElementById('p-speed').value) || 0;
        const growthSpeed = parseInt(document.getElementById('g-speed').value) || 0;
        const speedVal = baseSpeed + growthSpeed;
        
        initVal += speedVal; 
        labelText = "é€Ÿ+ä½“+é‹å‹•";
    }
    
    document.getElementById('init-val').innerText = initVal;
    document.getElementById('init-label').innerText = labelText;

    // æ¶ˆè²»ãƒã‚¤ãƒ³ãƒˆè¨ˆç®— & å…¥åŠ›åˆ¶é™
    let used = 0;
    document.querySelectorAll('.skill-base').forEach(el => {
        let lv = parseInt(el.value) || 0;
        // å…¥åŠ›åˆ¶é™: 3ã‚ˆã‚Šå¤§ãã‘ã‚Œã°3ã«æˆ»ã™
        if (lv > 3) {
            lv = 3;
            el.value = 3;
        }
        // ãƒã‚¤ãƒŠã‚¹ãƒã‚§ãƒƒã‚¯
        if (lv < 0) {
            lv = 0;
            el.value = 0;
        }
        used += getSkillCost(lv);
    });
    
    const rem = maxSkillPoints - used;
    const disp = document.getElementById('skill-rem');
    disp.innerText = rem; document.getElementById('skill-max').innerText = maxSkillPoints;
    disp.style.color = (rem < 0) ? '#ef4444' : '#d97706';
  }

  function awakeStand() {
    isAwake = true; document.getElementById('stand-section').style.display = 'block';
    document.querySelector('.awake-btn').style.display = 'none';
    document.getElementById('stp-container').style.display = 'flex';
    setTimeout(initChart, 100); calcAll();
  }
  
  function getStandParams() {
      const ids = ['power', 'speed', 'range', 'durability', 'precision', 'potential'];
      const values = [];
      ids.forEach(id => {
          const base = parseInt(document.getElementById(`p-${id}`).value) || 0;
          const growth = parseInt(document.getElementById(`g-${id}`).value) || 0;
          values.push(base + growth);
      });
      return values;
  }

  function initChart() {
    const ctx = document.getElementById('standChart').getContext('2d');
    if(myChart) myChart.destroy();
    myChart = new Chart(ctx, {
      type: 'radar',
      data: { labels: ['ç ´å£Š', 'ã‚¹ãƒ”ãƒ¼ãƒ‰', 'å°„ç¨‹', 'æŒç¶š', 'ç²¾å¯†', 'æˆé•·'], datasets: [{ label: 'ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿', data: [3,3,3,3,3,3], backgroundColor: 'rgba(124, 58, 237, 0.2)', borderColor: '#7c3aed', pointBackgroundColor: '#fff', pointBorderColor: '#7c3aed', borderWidth: 2 }] },
      options: { responsive: true, maintainAspectRatio: false, scales: { r: { min: 0, max: 6, ticks: { display: false, stepSize: 1 }, pointLabels: { font: { size: 12 }, color: '#333' } } }, plugins: { legend: { display: false } } }
    });
    updateChart();
  }
  function updateChart() {
    if(!myChart) return;
    const values = getStandParams();
    const maxVal = Math.max(...values, 5);
    myChart.options.scales.r.max = maxVal + 1;
    myChart.data.datasets[0].data = values;
    myChart.update(); 
    calcAll(); 
  }

  function updateExportView() {
    document.getElementById('out-pc-name').innerText = document.getElementById('pc-name').value || 'NO NAME';
    document.getElementById('out-pc-age').innerText = document.getElementById('pc-age').value;
    document.getElementById('out-pc-job').innerText = document.getElementById('pc-job').value;
    document.getElementById('out-pc-quirk').innerText = document.getElementById('pc-quirk').value;
    document.getElementById('out-pc-items').innerText = document.getElementById('pc-items').value || '(ãªã—)';
    document.getElementById('out-hp-val').innerText = document.getElementById('hp-val').innerText;
    document.getElementById('out-sp-val').innerText = document.getElementById('sp-val').innerText;
    
    const outStpBox = document.getElementById('out-stp-box');
    if(isAwake) {
      outStpBox.style.display = 'block';
      document.getElementById('out-stp-val').innerText = document.getElementById('stp-val').innerText;
    } else { outStpBox.style.display = 'none'; }

    let statsHTML = "";
    const attrs = {body:'ãƒœãƒ‡ã‚£', sense:'ã‚»ãƒ³ã‚¹', intelli:'ã‚¤ãƒ³ãƒ†ãƒª', mental:'ãƒ¡ãƒ³ã‚¿ãƒ«', charm:'ãƒãƒ£ãƒ¼ãƒ ', luck:'ãƒ©ãƒƒã‚¯'};
    for(let key in attrs) {
      const val = document.getElementById(key).value;
      statsHTML += `<b>${attrs[key]}:${val}</b>`;
      let skills = [];
      document.querySelectorAll(`.skill-base[data-attr="${key}"]`).forEach(el => { 
          const baseVal = parseInt(el.value) || 0;
          const growthInput = el.nextElementSibling;
          const growthVal = growthInput ? (parseInt(growthInput.value) || 0) : 0;
          const totalVal = baseVal + growthVal;

          if(totalVal > 0) {
              let skillName = el.getAttribute('data-name');
              const subId = el.getAttribute('data-sub');
              if(subId) {
                  const subVal = document.getElementById(subId).value;
                  if(subVal) skillName += `:${subVal}`;
              }
              skills.push(`${skillName}(Lv${totalVal})`); 
          }
      });
      if(skills.length > 0) statsHTML += ` <small>[${skills.join(',')}]</small>`;
      statsHTML += "<br>";
    }
    document.getElementById('out-pc-stats').innerHTML = statsHTML;

    if(isAwake) {
        document.getElementById('out-stand-name').innerText = document.getElementById('stand-name').value;
        document.getElementById('out-stand-ability').innerText = document.getElementById('stand-ability').value;
        document.getElementById('out-stand-rule').innerText = document.getElementById('stand-rule').value;
        const sForm = document.getElementById('stand-form').value;
        const sType = document.getElementById('stand-type').value;
        document.getElementById('out-stand-form').innerText = sForm;
        document.getElementById('out-stand-type').innerText = sType;
        
        const params = getStandParams(); 
        const labels = ['ç ´å£Š', 'é€Ÿ', 'å°„ç¨‹', 'æŒç¶š', 'ç²¾å¯†', 'æˆé•·'];
        const ranks = ['?','E','D','C','B','A','S','SS']; 
        const rangeText = document.getElementById('stand-range-text').value;
        let paramHTML = "";
        
        params.forEach((val, idx) => {
          let rankStr = (val < ranks.length) ? ranks[val] : `S+${val-5}`;
          if(val === 0) rankStr = "-";
          
          let suffix = (idx === 2 && rangeText) ? ` <span style="font-size:0.8rem;">(${rangeText})</span>` : "";
          
          const baseVal = parseInt(document.getElementById(`p-${['power','speed','range','durability','precision','potential'][idx]}`).value);
          const isGrown = val > baseVal;
          const style = isGrown ? 'color:#059669; font-weight:bold;' : (val >= 4 ? 'color:#7c3aed;' : '');
          const mark = isGrown ? 'â†‘' : '';

          paramHTML += `<div style="${style}">${labels[idx]}: ${rankStr}${mark}${suffix}</div>`;
        });
        document.getElementById('out-stand-params').innerHTML = paramHTML;

        const ctx = document.getElementById('outChart').getContext('2d');
        if(outChartInst) outChartInst.destroy();
        
        outChartInst = new Chart(ctx, { type: 'radar', data: { labels: ['ç ´å£Š', 'é€Ÿ', 'å°„ç¨‹', 'æŒç¶š', 'ç²¾å¯†', 'æˆé•·'], datasets: [{ label: 'Stand', data: params, backgroundColor: 'rgba(124, 58, 237, 0.1)', borderColor: '#7c3aed', pointBackgroundColor: '#7c3aed', borderWidth: 3 }] }, options: { animation: false, scales: { r: { min: 0, max: Math.max(...params, 5)+1, ticks: { display: false }, pointLabels: { font: { size: 14, weight:'bold' }, color: '#0f172a' }, grid: { color: '#cbd5e1' } } }, plugins: { legend: { display: false } } } });
    } else {
        document.getElementById('out-stand-name').innerText = "ï¼ˆæœªç™ºç¾ï¼‰";
        document.getElementById('out-stand-ability').innerText = "-";
        document.getElementById('out-stand-params').innerHTML = "";
        if(outChartInst) { outChartInst.destroy(); outChartInst = null; }
    }
  }

  // â˜…â˜…â˜… ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒ¬ãƒƒãƒˆæ•´ç†ï¼†SPå¤‰æ•°å¯¾å¿œï¼†ç‹¬è‡ªæŠ€èƒ½å¯¾å¿œ â˜…â˜…â˜…
  
  function getInitiativeValue() {
      const body = parseInt(document.getElementById('body').value) || 1;
      
      let athleticsTotal = 0;
      const athBaseInput = document.querySelector('input.skill-base[data-name="é‹å‹•"]');
      if(athBaseInput) {
          const base = parseInt(athBaseInput.value) || 0;
          const growth = parseInt(athBaseInput.nextElementSibling.value) || 0;
          athleticsTotal = base + growth;
      }
      
      let initVal = body + athleticsTotal;
      let label = "ä½“+é‹å‹•";
      
      if (isAwake) {
          const baseSpeed = parseInt(document.getElementById('p-speed').value) || 0;
          const growthSpeed = parseInt(document.getElementById('g-speed').value) || 0;
          const speedVal = baseSpeed + growthSpeed;
          
          initVal += speedVal;
          label = "é€Ÿ+ä½“+é‹å‹•";
      }
      return { value: initVal, label: label };
  }

  function getTarget(val) {
      return val * 2;
  }

  function getStandCheckTarget(val) {
      return val * 3;
  }

  function getStandAttackTarget(val) {
      return val * 4 - 2;
  }

  function copyPC() {
    const stats = { 
        body: parseInt(document.getElementById('body').value), 
        sense: parseInt(document.getElementById('sense').value), 
        intelli: parseInt(document.getElementById('intelli').value), 
        mental: parseInt(document.getElementById('mental').value),
        charm: parseInt(document.getElementById('charm').value),
        luck: parseInt(document.getElementById('luck').value)
    };
    
    const initData = getInitiativeValue();
    let commands = `// ã€“ã€“ã€“ åŸºæœ¬æƒ…å ±ãƒ»SP ã€“ã€“ã€“\n// [ã‚¤ãƒ‹ã‚·ã‚¢ãƒ†ã‚£ãƒ–]: ${initData.value} (å›ºå®šå€¤: ${initData.label})\n// ã‚¹ã‚¿ãƒ³ãƒ‰onçŠ¶æ…‹[STPæ¶ˆè²»]: è¡Œå‹•-2 / ã‚¿ãƒ¼ãƒ³çµŒé-1\n// [STPå›å¾©]: ONå¾…æ©Ÿ+2 / OFFå¾…æ©Ÿ+5 / ä¼‘æ†©å…¨å¿« / SPå¤‰æ›(1â†’2)\n`;
    
 

    commands += `\n// ã€“ã€“ã€“ æœ¬ä½“èƒ½åŠ›(1B20) ã€“ã€“ã€“\n`;
    commands += `1B20<=${stats.body*2} ã€ãƒœãƒ‡ã‚£ã€‘(ãƒ©ãƒ³ã‚¯${stats.body})\n`;
    commands += `1B20<=${stats.sense*2} ã€ã‚»ãƒ³ã‚¹ã€‘(ãƒ©ãƒ³ã‚¯${stats.sense})\n`;
    commands += `1B20<=${stats.intelli*2} ã€ã‚¤ãƒ³ãƒ†ãƒªã€‘(ãƒ©ãƒ³ã‚¯${stats.intelli})\n`;
    commands += `1B20<=${stats.mental*2} ã€ãƒ¡ãƒ³ã‚¿ãƒ«ã€‘(ãƒ©ãƒ³ã‚¯${stats.mental})\n`;
    commands += `1B20<=${stats.charm*2} ã€ãƒãƒ£ãƒ¼ãƒ ã€‘(ãƒ©ãƒ³ã‚¯${stats.charm})\n`;
    commands += `1B20<=${stats.luck*2} ã€ãƒ©ãƒƒã‚¯ã€‘(ãƒ©ãƒ³ã‚¯${stats.luck})\n`;

    commands += `\n// ã€“ã€“ã€“ æŠ€èƒ½åˆ¤å®š(LvB20) ã€“ã€“ã€“\n`;
    
    // å›ºå®šæŠ€èƒ½ã¨ç‹¬è‡ªæŠ€èƒ½ã‚’å…¨ã¦å‡¦ç†
    document.querySelectorAll('.skill-base').forEach(el => { 
        const baseVal = parseInt(el.value) || 0;
        const growthVal = parseInt(el.nextElementSibling.value) || 0;
        const totalLv = baseVal + growthVal;

        let attrKey = el.getAttribute('data-attr');
        let skillName = el.getAttribute('data-name');

        // ç‹¬è‡ªæŠ€èƒ½ã®å ´åˆã®å‡¦ç†
        if (el.dataset.isCustom) {
            const row = el.closest('.skill-row');
            const select = row.querySelector('select.custom-attr');
            const nameInput = row.querySelector('input.custom-name');
            
            attrKey = select.value;
            skillName = nameInput.value || 'ç‹¬è‡ªæŠ€èƒ½';
        }

        const attrVal = stats[attrKey];
        const target = (attrVal * 2) + totalLv; 
        
        if(totalLv > 0) {
            // å›ºå®šæŠ€èƒ½ã®ã‚µãƒ–é …ç›®ãƒã‚§ãƒƒã‚¯ (çŸ¥è­˜:ã€‡ã€‡ ç­‰)
            if (!el.dataset.isCustom) {
                const subId = el.getAttribute('data-sub');
                if(subId) {
                    const subVal = document.getElementById(subId).value;
                    if(subVal) skillName += `:${subVal}`;
                }
            }
            commands += `${totalLv}B20<=${target} æŠ€èƒ½:ã€${skillName}ã€‘(ç›®æ¨™${target})\n`; 
        }
    });
    
    const memo = `è·æ¥­: ${document.getElementById('pc-job').value}\n\nã€æ‰€æŒå“ã€‘\n${document.getElementById('pc-items').value}\n\nã€ã“ã ã‚ã‚Šã€‘\n${document.getElementById('pc-quirk').value}`;
    const statusArray = [
        { label: "HP", value: parseInt(document.getElementById('hp-val').innerText), max: parseInt(document.getElementById('hp-val').innerText) },
        { label: "SP", value: parseInt(document.getElementById('sp-val').innerText), max: parseInt(document.getElementById('sp-val').innerText) }
    ];
    if(isAwake) statusArray.push({ label: "STP", value: parseInt(document.getElementById('stp-val').innerText), max: parseInt(document.getElementById('stp-val').innerText) });
    
    const data = { kind: "character", data: { name: document.getElementById('pc-name').value || "PC", initiative: initData.value, memo: memo, status: statusArray, params: [ {label:"ä½“",value:stats.body.toString()},{label:"æ„Ÿ",value:stats.sense.toString()},{label:"çŸ¥",value:stats.intelli.toString()},{label:"ç²¾",value:stats.mental.toString()} ], commands: commands } };
    safeCopy(JSON.stringify(data));
  }

  function copyStand() {
    if(!isAwake) { showToast("ã‚¹ã‚¿ãƒ³ãƒ‰ãŒç™ºç¾ã—ã¦ã„ã¾ã›ã‚“"); return; }
    
    const pcStats = { 
        body: parseInt(document.getElementById('body').value), 
        sense: parseInt(document.getElementById('sense').value), 
        intelli: parseInt(document.getElementById('intelli').value), 
        mental: parseInt(document.getElementById('mental').value),
        charm: parseInt(document.getElementById('charm').value),
        luck: parseInt(document.getElementById('luck').value)
    };

    const params = getStandParams(); 
    const ranks = ['?','E','D','C','B','A','S','SS']; 
    
    const dicePower = params[0]; 
    const diceSpeed = params[1];
    const diceRange = params[2];
    const diceDur = params[3];
    const dicePrecision = params[4];
    const dicePotential = params[5];

    // æˆ¦é—˜ç”¨ç›®æ¨™å€¤
    const targetAttack = getStandAttackTarget(params[4]);
    const targetEvade = pcStats.sense * 3;
    const targetGuard = pcStats.mental * 3;

    // æ±ç”¨åˆ¤å®šç”¨ç›®æ¨™å€¤
    const targetCheckPower = getStandCheckTarget(pcStats.body);
    const targetCheckSpeed = getStandCheckTarget(pcStats.sense);
    const targetCheckRange = getStandCheckTarget(pcStats.intelli);
    const targetCheckDur = getStandCheckTarget(pcStats.mental);
    const targetCheckPrecision = getStandCheckTarget(pcStats.sense);
    const targetCheckPotential = getStandCheckTarget(pcStats.luck);

    const initData = getInitiativeValue();
    
    const sForm = document.getElementById('stand-form').value;
    let attackCmd = `ã€ç ´å£ŠåŠ›ã€‘æ”»æ’ƒ(å¨åŠ›:${params[0]})`;
    if (sForm.includes("äººå‹") && diceSpeed >= 4) { attackCmd = `ã€ç ´å£ŠåŠ›ã€‘ãƒ©ãƒƒã‚·ãƒ¥(å¨åŠ›:${params[0]})`; }

    let commands = `// ã€“ã€“ã€“ åŸºæœ¬æƒ…å ±ãƒ»SP ã€“ã€“ã€“\n// [ã‚¤ãƒ‹ã‚·ã‚¢ãƒ†ã‚£ãƒ–]: ${initData.value} (å›ºå®šå€¤: ${initData.label})\n// ã‚¹ã‚¿ãƒ³ãƒ‰onçŠ¶æ…‹[STPæ¶ˆè²»]: è¡Œå‹•-2 / ã‚¿ãƒ¼ãƒ³çµŒé-1\n// [STPå›å¾©]: ONå¾…æ©Ÿ+2 / OFFå¾…æ©Ÿ+5 / ä¼‘æ†©å…¨å¿« / SPå¤‰æ›(1â†’2)\n`;


    commands += `// ã€“ã€“ã€“ ã‚¹ã‚¿ãƒ³ãƒ‰æˆ¦é—˜(æ¶ˆè²»STP:2) ã€“ã€“ã€“\n`;
    commands += `${dicePower}B20<=${targetAttack} ${attackCmd}\n`;
    
    commands += `${diceSpeed}B20<=${targetEvade} ã€ã‚¹ãƒ”ãƒ¼ãƒ‰ã€‘å›é¿(ç›®æ¨™${targetEvade})\n`;
    commands += `// æˆåŠŸæ•°åˆ†ã€ãƒ’ãƒƒãƒˆæ•°ã‚’ç›¸æ®º\n\n`;
    
    commands += `${diceDur}B20<=${targetGuard} ã€æŒç¶šåŠ›ã€‘é˜²å¾¡(ç›®æ¨™${targetGuard})\n`;
    commands += `// æˆåŠŸæ•°åˆ†ã€ãƒ€ãƒ¡ãƒ¼ã‚¸è»½æ¸›\n\n`;
    
    commands += `// ã€“ã€“ã€“ ã‚¹ã‚¿ãƒ³ãƒ‰æ±ç”¨åˆ¤å®š(ç›®æ¨™:èƒ½åŠ›x3) ã€“ã€“ã€“\n`;
    commands += `${dicePower}B20<=${dicePrecision}ï¼Š4-2 ã€ç ´å£ŠåŠ›ã€‘åˆ¤å®š(ç²¾å¯†Ã—4-2)\n`;
    commands += `${diceSpeed}B20<=${targetCheckSpeed} ã€ã‚¹ãƒ”ãƒ¼ãƒ‰ã€‘åˆ¤å®š(æ„Ÿx3)\n`;
    commands += `${diceRange}B20<=${targetCheckRange} ã€å°„ç¨‹ã€‘åˆ¤å®š(çŸ¥x3)\n`;
    commands += `${diceDur}B20<=${targetCheckDur} ã€æŒç¶šåŠ›ã€‘åˆ¤å®š(ç²¾x3)\n`;
    commands += `${dicePrecision}B20<=${targetCheckPrecision} ã€ç²¾å¯†ã€‘åˆ¤å®š(æ„Ÿx3)\n`;
    commands += `${dicePotential}B20<=${targetCheckPotential} ã€æˆé•·ã€‘åˆ¤å®š(é‹x3)\n`;
    
    const rangeText = document.getElementById('stand-range-text').value;
    let rangeDisp = ranks[params[2]];
    if(rangeText) rangeDisp += `(${rangeText})`;

    const memo = `åˆ†é¡: ${sForm} / ${document.getElementById('stand-type').value}\nèƒ½åŠ›: ${document.getElementById('stand-ability').value}\n\nç ´å£Š:${ranks[params[0]]} é€Ÿ:${ranks[params[1]]} å°„ç¨‹:${rangeDisp}\næŒç¶š:${ranks[params[3]]} ç²¾å¯†:${ranks[params[4]]} æˆé•·:${ranks[params[5]]}`;

    const data = {
      kind: "character",
      data: {
        name: document.getElementById('stand-name').value || "ã‚¹ã‚¿ãƒ³ãƒ‰",
        initiative: initData.value, 
        memo: memo,
        params: [ {label:"ç ´å£Š",value:params[0].toString()}, {label:"é€Ÿ",value:params[1].toString()} ],
        commands: commands
      }
    };
    safeCopy(JSON.stringify(data));
  }

  // --- ä¿å­˜ãƒ»èª­è¾¼ ---
  function getAllData() { const data = {}; document.querySelectorAll('input, select, textarea').forEach(el => { if(el.id && el.type !== 'file' && el.id !== 'char-list') data[el.id] = el.value; }); data.isAwake = isAwake; return data; }
  function setAllData(data) { if(!data) return; Object.keys(data).forEach(key => { const el = document.getElementById(key); if(el) el.value = data[key]; }); if(data.isAwake) { awakeStand(); } else { document.getElementById('stand-section').style.display = 'none'; document.querySelector('.awake-btn').style.display = 'block'; isAwake = false; document.getElementById('stp-container').style.display = 'none'; } calcAll(); if(isAwake) setTimeout(updateChart, 200); }
  function saveToBrowser() { const name = document.getElementById('pc-name').value || 'NoName'; const allData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; allData[name] = getAllData(); localStorage.setItem(STORAGE_KEY, JSON.stringify(allData)); updateList(); showToast(`ã€Œ${name}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸ`); }
  function loadFromBrowser() { const name = document.getElementById('char-list').value; if(!name)return; setAllData(JSON.parse(localStorage.getItem(STORAGE_KEY))[name]); showToast("èª­ã¿è¾¼ã¿ã¾ã—ãŸ"); }
  function deleteFromBrowser() { const name = document.getElementById('char-list').value; if(!name||!confirm(`ã€Œ${name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return; const allData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; delete allData[name]; localStorage.setItem(STORAGE_KEY, JSON.stringify(allData)); updateList(); showToast("å‰Šé™¤ã—ã¾ã—ãŸ"); }
  function updateList() { const list = document.getElementById('char-list'); const allData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; list.innerHTML = '<option value="">(é¸æŠã—ã¦ãã ã•ã„)</option>'; Object.keys(allData).forEach(name => { const opt = document.createElement('option'); opt.value = name; opt.innerText = name; list.appendChild(opt); }); }
  function downloadJSON() { const data = getAllData(); const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `jojo_${data['pc-name'] || 'char'}.json`; a.click(); }
  function uploadJSON(input) { if(input.files.length===0) return; const reader = new FileReader(); reader.onload = function(e){ try { setAllData(JSON.parse(e.target.result)); showToast("JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ"); } catch(err) { alert("ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“"); } }; reader.readAsText(input.files[0]); }
  
  window.addEventListener('DOMContentLoaded', () => { calcAll(); updateList(); });
  window.onclick = function(event) { if (event.target == document.getElementById('helpModal')) document.getElementById('helpModal').style.display = "none"; }
</script>

</body>
</html>
